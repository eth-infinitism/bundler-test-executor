<head>
<style>
#results {
  font-family: Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  /*width: 100%;*/
}

#results td, #results th {
  border: 1px solid #ddd;
  padding: 8px;
}

#results tr:nth-child(even){background-color: #f2f2f2;}

#results tr:hover {background-color: #ddd;}

#results th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
  background-color: #04AA6D;
  color: white;
}
</style>
</head>

<h1>EIP-4337 Bundlers Spec Test Results</h1>
<div id=output >
</div>

<p>

This page was generated by <a href="https://github.com/eth-infinitism/bundler-test-results">bundler-test-results</a>


<script>

okmark = '&#9989;'
errmark = '&#10060;'
const dir = './out/'
async function getList() {
  list = await fetch(dir+'index.txt').then(r=>r.text())
  return list.split('\n').filter(line=>line.endsWith('json')).map(line=>dir+line)
}

async function getJson(path) {
   return await fetch(path).then(r=>r.json())
}

function mapTests(testcases) {
  return testcases.map(t=>({
	name: t['@name'],
	classname: t['@classname'],
	time: t['@time'],
	skipped: t['skipped'],
	error: t['error'],
	failure: t['failure'],
  }))
}

async function load() {
  list = await getList()
  out=[]
  for ( fname of list ) {
    const j = await getJson(fname)
    test = j.testsuites.testsuite
    res = {
	name: test['@name'],
  fname, //: fname.replace(/.*\/(.*.json)$/,'$1'),
	skipped:  test['@skipped'],
	failures: test['@failures'],
	errors: test['@errors'],
	time: test['@time'],
        tests: mapTests(test.testcase)
    }
console.log('res=',JSON.stringify(res,null,2))
    out.push(res)
  }

  return out
}

function ref(data,link) {
  if ( !link) return data
  return `<a href="${link}">${data}</a>`
}

function tr(...data) {
  return `<tr>${data.join(' ')}</tr>`
}

function th(data) {
  // return td(data)
  return `<th>${data}</th>`
}

function td(data,link) {
  return `<td>${ref(data,link)}</td>`
}

async function init() {
  data = await load()
console.log(data)
  rows = document.querySelector('#output')

  rows.innerHTML = '<table id="results"><tbody>\n' + 
		tr(th('Name'),th('Total'),th('Errors'),th('Failures'),th('Skipped'),th('Time')) +
	data.map(line=>{
		const {name, fname, skipped, errors,failures, time, tests} = line
		link = fname.replace('json', 'txt')
		ok = failures== '0' && errors == '0'
		return tr(td(name, link),td(tests.length),td(errors),td(failures),td(skipped),td(time))
	}).join('\n')
	'</tbody></table>'

console.log(rows.innerHTML)

}
init()

</script>

